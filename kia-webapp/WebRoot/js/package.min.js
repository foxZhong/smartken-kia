Class=new Object();Class.forName=function(fullNS){var nsArray=fullNS.split(".");var sEval="";var sNS="";for(var i=0;i<nsArray.length;i++){if(i!=0){sNS+="."}sNS+=nsArray[i];sEval+="if (typeof("+sNS+") == 'undefined') "+sNS+" = new Object();"}if(sEval!=""){eval(sEval)}};Class.forName("Kia.util");Kia.util={isDateFormat:function(c,d){if(c.length!=d.length){return false}var a=c;a=a.replace(/yyyy/,"[0-9]{4}");a=a.replace(/yy/,"[0-9]{2}");a=a.replace(/MM/,"((0[1-9])|1[0-2])");a=a.replace(/M/,"(([1-9])|1[0-2])");a=a.replace(/dd/,"((0[1-9])|([1-2][0-9])|30|31)");a=a.replace(/d/,"([1-9]|[1-2][0-9]|30|31))");a=a.replace(/HH/,"(([0-1][0-9])|20|21|22|23)");a=a.replace(/H/,"([0-9]|1[0-9]|20|21|22|23)");a=a.replace(/mm/,"([0-5][0-9])");a=a.replace(/m/,"([0-9]|([1-5][0-9]))");a=a.replace(/ss/,"([0-5][0-9])");a=a.replace(/s/,"([0-9]|([1-5][0-9]))");var b=new RegExp("^"+a+"$");return b.test(d)},parseDateTime:function(m,o){if(m.length!=o.length){return null}var b=m.indexOf("yyyy");var g=m.indexOf("MM");var a=m.indexOf("dd");var q=m.indexOf("HH");var i=m.indexOf("mm");var c=m.indexOf("ss");var l=new Date();try{if(b==-1||g==-1||a==-1){return null}var n=parseInt(o.substr(b,4));var j=parseInt(o.substr(g,2));var p=parseInt(o.substr(a,2));l.setFullYear(n,j-1,p);if(q!=-1){var h=parseInt(o.substr(q,2));l.setHours(h)}if(i!=-1){var f=parseInt(o.substr(f,2));l.setMinutes(f)}if(c!=-1){var e=parseInt(o.substr(c,2));l.setSeconds(e)}return l}catch(k){return null}},strToJson:function(jsonStr){return eval("("+jsonStr+")")},handleJsonResult:function(b){var f=b.msg||"";var e=b.title||"操作";var c=b.icon||"info";var d=b.action||"show";var a=false;if(d=="show"){$.messager.show({title:e,msg:f,timeout:5000,showType:"slide",showSpeed:500})}else{if(d=="alert"){$.messager.alert(e,f,c,function(){return true})}else{if(d=="confirm"){$.messager.confirm(e,f,function(g){return g})}else{if(d=="prompt"){$.messager.prompt(e,f,function(g){return g})}}}}}};Class.forName("Kia.setting");Kia.setting={dateboxFormat:"yyyy-MM-dd",precision:2};jQuery.fn.extend({kiaLoadFields:function(){$(this).find("input:enabled").each(function(){if($(this).hasClass("easyui-combobox")){$(this).combobox()}else{if($(this).hasClass("kia-intbox")){$(this).kiaIntbox()}else{if($(this).hasClass("kia-doublebox")){$(this).kiaDoublebox()}else{if($(this).hasClass("kia-combogrid")){$(this).kiaCombogrid()}else{if($(this).hasClass("kia-datebox")){$(this).kiaDatebox()}}}}}});return true},kiaIframe:function(a){$(this).html("<iframe scrolling='no' frameborder='0' src='"+a+"' style='width:99%;height:99%;overflow:hidden;'></iframe>")},kiaAuthFields:function(a){var b=$(this);if(!a){return false}b.find("input").each(function(){var d=$(this).attr("name")||null;if(d){var c=a[d];switch(c){case 0:$(this).addClass("invisible").attr("disabled","disabled");break;case 1:$(this).addClass("readonly").attr("readonly","true");break;default:$(this).addClass("editable")}}});return true},kiaCombogrid:function(){var d=$(this);var e=d.attr("name");var i=d.attr("valueField")||"id";var k=d.attr("textField")||"name";var o=d.attr("url")||"";var n=d.attr("required")||true;var b=d.attr("selecterWidth")||60;var h=d.attr("disabled");var m=d.attr("dataClass")||"";var j=d.width();var c=d.height();d.width(j-b);var f=d.val()||"";var g=$("<input>").width(b);d.before(g);d.combobox({hasDownArrow:false,editable:false,required:n,textField:k,valueField:i});g.combogrid({panelWidth:j,disabled:h,idField:i,textField:i,value:f,columns:[[{field:i,width:b},{field:k,width:j}]],onChange:function(p,q){if(!p||!q||p==q){return}d.combobox("select",p)},onSelect:function(p,q){d.combobox("select",q[i])}});var l=_comboData[m];if(l){var a=g.combogrid("grid");a.datagrid("loadData",l);d.combobox("loadData",l.rows)}},kiaDatebox2:function(){try{var c=$(this);var b=c.attr("value")||"";var a="";if(b!=""){var g=Date.parse(b);a=g.toString(Kia.custom.setting.dbDateFormat);c.val(a)}c.datebox({onChange:Kia.easyui.datebox.onChangeHandler,onSelect:function(d){c.datebox("setValue",d.format(Kia.custom.setting.dbDateFormat))}});var f=c.next().find("input:first");f.blur(function(){if($(this).val()==null||$(this).val()==""){return}var h=Kia.util.isDateFormat(Kia.custom.setting.dbDateFormat,$(this).val());if(h){var j=dateboxObj.datebox("calendar");var i=j.calendar("options");var k=i.current;c.datebox("setValue",k.format(Kia.custom.setting.dbDateFormat))}else{$.messager.show({title:"输入错误",msg:"日期格式必须符合"+Kia.custom.setting.dbDateFormat});c.datebox("setValue",a)}})}catch(e){alert(e)}},kiaDatebox:function(){var c=$(this);var b=c.attr("value")||"";var a="";if(b!=""){try{var f=new Date(b);a=f.toString(Kia.custom.setting.dbDateFormat);c.val(a)}catch(e){alert(e)}}else{c.val("")}c.datebox({validType:"date['yyyy-MM-dd']"})},kiaDoublebox:function(){$(this).numberbox({increment:10,precision:Kia.setting.precision})},kiaIntbox:function(){$(this).numberbox({increment:10,precision:0})}});$.extend($.fn.validatebox.defaults.rules,{minLength:{validator:function(a,b){return a.length>=b[0]},message:"Please enter at least {0} characters."},date:{validator:function(b,c){var a=c[0]||Kia.setting.dateboxFormat;return Kia.util.isDateFormat(a,b)},message:"日期格式必须符合 {0}"}});function editorsResizeHandler(c,b){var a=$(c);if($.boxModel==true){a.width(b-(a.outerWidth()-a.width()))}else{a.width(b)}}$.extend($.fn.datagrid.defaults.editors,{kiaDatebox:{init:function(a,c){var b=$('<input type="text" class="datagrid-editable-input">').appendTo(a);var d=c||{};d.editable=false;d.formatter=function(e){return e.format("yyyy-MM-dd")};b.datebox(d);return b},getValue:function(b){var a=b.next().find(".combo-value:first").val();var c=Date.parseExact(a,"yyyy-MM-dd");return c.toString("yyyy-MM-dd")},setValue:function(b,a){if(a==null||a==""){return}var c=new Date(parseInt(a));$(b).datebox("setValue",c.toString("yyyy-MM-dd"))},resize:editorsResizeHandler},kiaDoublebox:{init:function(a,c){var b=$('<input type="text" class="datagrid-editable-input">').appendTo(a);var d=c||{};b.numberbox({increment:10,precision:2});return b},getValue:function(a){return $(a).val()},setValue:function(b,a){$(b).val(a)},resize:editorsResizeHandler},kiaIntbox:{init:function(a,c){var b=$('<input type="text" class="datagrid-editable-input">').appendTo(a);var d=c||{};b.numberbox({increment:10,precision:0});return b},getValue:function(a){return $(a).val()},setValue:function(b,a){$(b).val(a)},resize:editorsResizeHandler}});$.fn.datebox.defaults.formatter=function(a){if(a){return a.toString(Kia.setting.dateboxFormat)}else{return""}};$.fn.datebox.defaults.parser=function(b){try{if(!b||b==""){return new Date()}return Date.parse(b)}catch(a){return new Date()}};var CrudDatagrid=function(d,e,b,c,a){this._basePath=e||"";this._dgRegexp=d||"#DG";this._modelClass=b||"";this._idField=c||"id";this._initRow=a||function(){return{}}};CrudDatagrid.prototype={init:function(e){var f={iconCls:"icon-add",text:"新建",handler:function(){var g=new this._initRow();$(this._dgRegexp).datagrid("appendRow",g)}};var a={iconCls:"icon-remove",text:"删除",handler:function(){var g=$(this._dgRegexp).datagrid("getSelections");var h="";$.each(g,function(i,j){var k=$(this._dgRegexp).datagrid("getRowIndex",j);h+=","+j[this._idField]});$.messager.confirm("操作提示","是否删除"+g.length+"条记录",function(i){var j=_basePath+"/common/Datagrid/do/removeRows.action?modelClass="+this._modelClass;$.post(j,{ids:h},function(k){k.handleMessager();$(_dgRegexp).datagrid("reload")})})}};var c={iconCls:"icon-reload",text:"刷新",handler:function(){$(this._dgRegexp).datagrid("reload")}};var d=[f,a,c];e.toolbar=d;e.onDblClickRow=function(h,g){if(row.editing){this.cancelEditRow(h)}else{this.beginEditRow(h)}};for(var b in e){alert(e[b])}$(this).datagrid(e);alert("init")},saveRow:function(d){var b=$(this).datagrid("getRows");var c=b[d];$(this).datagrid("endEdit",d);if(!c.editing){return}var a=this._basePath+"common/Datagrid/do/saveRow.action?modelClass="+this._modelClass;$.post(a,c,function(e){e.handleMessager();c.editing=false;c.removed=false;$(this._dgRegexp).datagrid("refreshRow",d)})},beginEidtRow:function(c){var a=$(this._dgRegexp).datagrid("getRows");var b=a[c];b.editing=true;$(this._dgRegexp).datagrid("refreshRow",c);$(this._dgRegexp).datagrid("beginEdit",c)},cancelEditRow:function(c){var a=$(this._dgRegexp).datagrid("getRows");var b=a[c];b.editing=false;$(this._dgRegexp).datagrid("cancelEdit",c);$(this._dgRegexp).datagrid("refreshRow",c)}};function getOperaFormatter(a){var b=function(h,i,e){var d="";var g="<a title='编辑' href='javascript:void(0)' class='kia-icon edit' onclick='"+a+".beginEditRow("+e+");'></a>";var c="<a title='保存' href='javascript:void(0)' class='kia-icon ok-blue' onclick='"+a+".saveRow("+e+");'></a>";var f="<a title='取消' href='javascript:void(0)' class='kia-icon stop-red' onclick='"+a+".cancelEditRow("+e+");'></a>";if(i.editing){d=c+f}else{d=g}return d};return b}function stateFormatter(c,d,a){var b="flag-green";if(d.removed){b="flag-red"}return"<div class='kia-icon "+b+"'></div>"}function dateboxFormatter(c,d,b){if(c==null||c==""){return""}var a=new Date();a.setTime(c);if(a==null){return c}return a.toString("yyyy-MM-dd")}function dateTimeboxFormatter(c,d,b){if(c==null||c==""){return""}var a=new Date();a.setTime(c);if(a==null){return c}return a.toString("yyyy-MM-dd HH:mm:ss")}function operaFormatter(f,g,c){var b="";var e="<a title='编辑' href='javascript:void(0)' class='kia-icon edit' onclick='editRow("+c+");'></a>";var a="<a title='保存' href='javascript:void(0)' class='kia-icon ok-blue' onclick='saveRow("+c+");'></a>";var d="<a title='取消' href='javascript:void(0)' class='kia-icon stop-red' onclick='cancelEditRow("+c+");'></a>";if(g.editing){b=a+d}else{b=e}return b};